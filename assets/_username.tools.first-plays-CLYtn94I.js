import{aa as j,j as e,a as m,R as g,f as S,b as F,a0 as w}from"./index-zwKx1JV-.js";import{E as M,G as b,H as I,J as k,K as $,L as G,N as Y,u as L,j as O,M as B,A as T,W as p,k as E,l as H,m as N,S as V,f as W,n as U,g as A,C as Q,b as q,D as J,r as K,s as Z,h as _,I as z}from"./TableWithPagination-BKcqby4q.js";const X=async a=>{if(!a)return[];const s=await j.users.get({username:a}),t=await j.plays.where({recordingUserId:s?.userId}).toArray(),l=[];return t.forEach(r=>{let{playId:i,gameId:c,date:d,gameName:n}=r;l.some(o=>o.gameId===c)||l.push({playId:i,gameId:c,date:d,gameName:n})}),l};function ee(a){const s=k(),t=[s.accessor("playId",{cell:r=>{const i=r.getValue();return e.jsx("a",{href:`https://www.boardgamegeek.com/play/details/${i}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(M,{width:16})})},header:()=>"",enableSorting:!1}),s.accessor("date",{cell:r=>r.getValue(),header:()=>"Date",sortingFn:b.datetime}),s.accessor("gameName",{cell:r=>r.getValue(),header:()=>"Game",sortingFn:b.basic})];return I({data:a,columns:t,getCoreRowModel:$(),getPaginationRowModel:G(),getSortedRowModel:Y()})}function ae({plays:a,selection:s,setSelection:t}){const[l,r]=m.useState(""),[i,c]=m.useState(!1),d=g.useRef(null),n=g.useRef(null),u=g.useRef(null),o=L(l,350),x=f=>{t(f)},P=o===""||!o?a:a?.filter(f=>f.gameName.toLowerCase().includes(o?.toLowerCase())),R=()=>{u?.current?.click&&u.current.click()},C=()=>{t("")},y=se(s);return e.jsxs("div",{className:`relative flex items-center ${O} hover:cursor-pointer`,children:[e.jsx(B,{value:`Game${y&&": "}${y}`,visible:i,setVisible:c,impactedRef:d,addedWidth:s?30:2}),e.jsxs("div",{ref:d,className:"flex items-center w-full gap-4 overflow-hidden font-semibold text-left transition-all whitespace-nowrap sm:max-w-sm",onClick:R,children:["Game",y&&":"," ",y,s?e.jsx("button",{className:"text-slate-400 hover:text-red-500",onClick:C,children:e.jsx(T,{width:16})}):null]}),e.jsx("div",{className:"grid auto-rows-min",children:e.jsx(p,{value:s,onChange:x,nullable:!0,children:({open:f})=>e.jsx("div",{className:`${f?"":"hidden"}`,children:e.jsxs("div",{className:`${E} ${H} divide-y divide-slate-500`,children:[e.jsxs("div",{className:`flex px-4 py-2  ${N} relative md:static`,children:[e.jsx(p.Input,{ref:n,onChange:h=>r(h.currentTarget.value),value:l,autoFocus:!0,placeholder:"search",className:`flex-1 px-2 bg-transparent font-semibold transition-all ease-in-out duration-500 ${N} focus:outline-0`}),e.jsx(V,{className:"cursor-default text-slate-500"}),e.jsx(p.Button,{ref:u,className:"display-none"})]}),e.jsx(p.Options,{id:"game-combobox-options",className:"max-h-72 overflow-y-auto py-2",static:!0,children:P?.map(h=>e.jsx(p.Option,{value:h.gameName,as:m.Fragment,children:({active:D,selected:v})=>e.jsxs("li",{onClick:()=>{r("")},className:`flex items-center gap-1  ${W} ${U} ${v?"font-bold":""} ${D?A:""}`,children:[v?e.jsx("div",{className:"w-4",children:e.jsx(Q,{width:16,strokeWidth:3,className:"text-green-500"})}):e.jsx("div",{className:"w-4"}),e.jsx("span",{className:"flex-1",children:h.gameName})]})},h.gameId))})]})})})})]})}const se=a=>a?a.length>20?`${a.slice(0,20)}...`:a:"";function te({dateRange:a,setDateRange:s,showDateSelector:t,setShowDateSelector:l}){const[r,i]=m.useState(!1),c=n=>{s(n)},d=n=>{n.stopPropagation(),s([void 0,void 0])};return e.jsxs("div",{onClick:()=>{i(!0),l()},className:`relative flex items-center gap-4 ${q} hover:cursor-pointer`,children:[e.jsxs("div",{className:"font-semibold",children:["Date",t&&":"]}),t?e.jsxs(e.Fragment,{children:[e.jsx(J,{value:a,onChange:c,calendarIcon:null,clearIcon:null,showLeadingZeros:!0,locale:"en-US",nextLabel:e.jsx(K,{width:16}),prevLabel:e.jsx(Z,{width:16}),format:"yyyy-MM-dd",autoFocus:!1,openCalendarOnFocus:!0,isOpen:r,onCalendarClose:()=>i(!1),rangeDivider:"and"}),e.jsx("div",{onClick:d,className:" hover:text-red-500",children:e.jsx(_,{width:16})})]}):null]})}const re=(a,s)=>{switch(s.type){case"setInitialData":return{...a,plays:s.payload.plays,filteredPlays:s.payload.filteredPlays};case"setPlays":return{...a,plays:s.payload};case"setFilteredPlays":return{...a,filteredPlays:s.payload};case"setGameName":return{...a,selectedGameName:s.payload,dateRange:[void 0,void 0],filteredPlays:le(a.plays,s.payload),showDateSelector:!1};case"setDateRange":return{...a,dateRange:s.payload,selectedGameName:"",filteredPlays:ne(a.plays,s.payload)};case"showDateSelector":return{...a,showDateSelector:s.payload};default:return a}};function ce(){const{username:a}=S(),{addPageView:s,loading:t}=F(),[{plays:l,filteredPlays:r,dateRange:i,selectedGameName:c,showDateSelector:d},n]=m.useReducer(re,{selectedGameName:"",dateRange:[void 0,void 0],plays:[],filteredPlays:[],showDateSelector:!1});m.useEffect(()=>{t||s("first-plays")},[]),m.useEffect(()=>{a&&X(a).then(o=>{n({type:"setInitialData",payload:{plays:o,filteredPlays:o}})})},[a]);const u=ee(r);return e.jsxs("div",{className:"w-full lg:w-[960px] xl:w-[1024] 2xl:w-[1280] mx-auto",children:[e.jsx("h1",{className:"text-5xl font-semibold text-white",children:"Find your first recorded plays"}),e.jsxs("p",{className:"mt-2 text-white",children:["Find the first time you recorded a play of a given game or all the games you played for the first time in a time period."," "]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-8 mb-4",children:[e.jsx(ae,{plays:l.sort((o,x)=>o.gameName.localeCompare(x.gameName)),selection:c,setSelection:o=>n({type:"setGameName",payload:o})}),e.jsx(te,{setDateRange:o=>n({type:"setDateRange",payload:o}),dateRange:i,showDateSelector:d,setShowDateSelector:()=>n({type:"showDateSelector",payload:!0})})]}),e.jsx(z,{table:u})]})}const le=(a,s)=>s?a?.filter(t=>t.gameName.toLowerCase().includes(s.toLowerCase())):a,ne=(a,s)=>{const[t,l]=s;return!t&&!l?a:(console.log("hit"),a.filter(i=>{const c=w(i.date).format("YYYYMMMDD"),d=w(t).format("YYYYMMMDD"),n=w(l).format("YYYYMMMDD");return c>=d&&c<=n}))};export{ce as Component};
